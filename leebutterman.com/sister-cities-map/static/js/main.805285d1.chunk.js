(this["webpackJsonpsister-cities-map"]=this["webpackJsonpsister-cities-map"]||[]).push([[0],{150:function(t,e){},224:function(t,e,n){t.exports=n(319)},229:function(t,e,n){},230:function(t,e,n){},235:function(t,e){},237:function(t,e){},269:function(t,e){},270:function(t,e){},313:function(t,e){},319:function(t,e,n){"use strict";n.r(e);var a=n(11),o=n.n(a),r=n(79),i=n.n(r),l=(n(229),n(27)),c=n(18),u=n(108),s=n(5),h=n.n(s),d=n(10),f=n(1),m=n(6),g=n(3),p=n(2),v=n(4),k=(n(230),n(333)),b=n(332),w=n(334),y=n(336),x=n(337),S=n(151),C=n(208),E=n(231),A=n(312),T={longitude:-73.99,latitude:40.69,zoom:10,pitch:0,bearing:0};var j=function(t){function e(t){var n;Object(f.a)(this,e),n=Object(g.a)(this,Object(p.a)(e).call(this,t));var a=decodeURI(window.location.hash.slice(1));return n.state={placeToZoom:a,searchboxtext:"",viewState:T,onlyFar:!0,only100kTitles:!0,farsims:new Set,allsims:new Set},E({locateFile:function(t){return"./".concat(t)}}).then((function(t){n.state.SQL=t,n.makeAutocomplete()})),n}return Object(v.a)(e,t),Object(m.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.loadPages(),fetch("./autocomplete.db").then((function(e){return e.arrayBuffer().then((function(e){t.state.autocompleteBuffer=e,t.makeAutocomplete()}))})),this.loadSims()}},{key:"loadSims",value:function(){var t,e=this,n=(t=[]).concat.apply(t,Object(d.a)([!0,!1].map((function(t){return Array.from({length:20},(function(n,a){return{url:"./tops".concat(t?"Far":"","Packed.ps").concat(a+1,".arrow"),column:"ps".concat(a+1),sink:t?e.state.farsims:e.state.allsims}}))}))));A.eachLimit(n,4,(function(t,n){var a,o,r,i,l;return h.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return a=t.url,o=t.column,r=t.sink,c.next=3,h.a.awrap(S.a.from(fetch(a)));case 3:i=c.sent,l=i.getColumn(o).toArray(),r.add(l),e.setState({simsloaded:e.state.farsims.length+e.state.allsims.length}),n();case 8:case"end":return c.stop()}}))}))}},{key:"loadPages",value:function(){var t=this;S.a.from(fetch("./pages.noindex.arrow")).then((function(e){return t.setState({pages:e,lng:e.getColumn("lng").toArray(),lat:e.getColumn("lat").toArray(),title:e.getColumn("title"),characterSet:(e.getColumn("title"),[" ","!",'"',"$","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","=","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","~","\xab","\xb0","\xb3","\xb4","\xb7","\xba","\xbb","\xbd","\xc0","\xc1","\xc2","\xc4","\xc5","\xc6","\xc7","\xc8","\xc9","\xcc","\xcd","\xce","\xd0","\xd1","\xd2","\xd3","\xd4","\xd5","\xd6","\xd7","\xd8","\xda","\xdc","\xdd","\xde","\xdf","\xe0","\xe1","\xe2","\xe3","\xe4","\xe5","\xe6","\xe7","\xe8","\xe9","\xea","\xeb","\xec","\xed","\xee","\xef","\xf0","\xf1","\xf2","\xf3","\xf4","\xf5","\xf6","\xf8","\xf9","\xfa","\xfb","\xfc","\xfd","\xfe","\xff","\u0100","\u0101","\u0103","\u0104","\u0105","\u0106","\u0107","\u010a","\u010b","\u010c","\u010d","\u010e","\u010f","\u0110","\u0111","\u0112","\u0113","\u0115","\u0117","\u0119","\u011b","\u011e","\u011f","\u0120","\u0121","\u0122","\u0123","\u0126","\u0127","\u0129","\u012a","\u012b","\u012f","\u0130","\u0131","\u0136","\u0137","\u013b","\u013c","\u013d","\u013e","\u0141","\u0142","\u0144","\u0145","\u0146","\u0147","\u0148","\u014b","\u014c","\u014d","\u014f","\u0150","\u0151","\u0152","\u0153","\u0155","\u0158","\u0159","\u015a","\u015b","\u015d","\u015e","\u015f","\u0160","\u0161","\u0162","\u0163","\u0164","\u0165","\u0169","\u016a","\u016b","\u016d","\u016f","\u0171","\u0173","\u0174","\u0175","\u0177","\u0179","\u017a","\u017b","\u017c","\u017d","\u017e","\u018f","\u01a1","\u01af","\u01b0","\u01c1","\u01c2","\u01c3","\u01eb","\u01f4","\u01f5","\u0218","\u0219","\u021a","\u021b","\u0259","\u0294","\u02b9","\u02bb","\u02bc","\u02bd","\u02bf","\u0300","\u0301","\u0304","\u0328","\u0331","\u03a0","\u03ac","\u03ad","\u03b1","\u03b3","\u03b7","\u03b9","\u03bb","\u03bd","\u03bf","\u03c1","\u03c4","\u03c5","\u03c6","\u0456","\u0627","\u0629","\u062a","\u062d","\u0641","\u1e0d","\u1e0f","\u1e25","\u1e29","\u1e30","\u1e31","\u1e34","\u1e35","\u1e36","\u1e37","\u1e3b","\u1e47","\u1e5f","\u1e63","\u1e6d","\u1e6f","\u1e81","\u1e94","\u1ea1","\u1ea2","\u1ea3","\u1ea4","\u1ea5","\u1ea7","\u1ea9","\u1eab","\u1ead","\u1eaf","\u1eb1","\u1eb5","\u1eb7","\u1eb8","\u1eb9","\u1ebb","\u1ebd","\u1ebf","\u1ec1","\u1ec3","\u1ec5","\u1ec7","\u1ec9","\u1ecb","\u1ecd","\u1ecf","\u1ed1","\u1ed3","\u1ed5","\u1ed7","\u1ed9","\u1edb","\u1edd","\u1edf","\u1ee3","\u1ee5","\u1ee7","\u1ee8","\u1ee9","\u1eeb","\u1eed","\u1eef","\u1ef1","\u1ef3","\u1ef7","\u1ef9","\u2013","\u2014","\u2018","\u2019","\u201c","\u201d","\u2020","\u2022","\u2032","\u2116","\u2212","\u3005","\u306e","\u30ac","\u30d2","\u30e2","\u30f3","\u4eba","\u65cf","\ua78c"])})}))}},{key:"makeAutocomplete",value:function(){this.state.SQL&&this.state.autocompleteBuffer&&this.setState({db:new this.state.SQL.Database(new Uint8Array(this.state.autocompleteBuffer))})}},{key:"makeDensityHeatmap",value:function(t){var e=t.lng,n=t.lat,a=t.count,o=t.sidelength,r=2*o,i=function(t,e){return Math.round((r-1)/(t+180))*o+Math.round((o-1)/(e+90))},l=new Float32Array(o*r),c=Float32Array.from({length:a},(function(t,a){return++l[i(e[a],n[a])]})),u=Float32Array.from({length:a},(function(t,a){return Math.max(8.57,33554432/Math.pow(a+4,.75)/Math.log1p(Math.pow(c[a],30)*Math.pow(Math.min(100*(a+1),l[i(e[a],n[a])]),1.5)))}));return{density:l,rankInDensity:c,sizes:u}}},{key:"makeTitles",value:function(t){var e=t.lng,n=t.lat,a=t.title,o=t.count,r=t.characterSet,i=t.onHover,l=t.onClick,c=this.makeDensityHeatmap({lng:e,lat:n,count:o,sidelength:1e4}).sizes;return new w.a({id:"titles".concat(o),data:{length:o},pickable:!0,onHover:i,onClick:l,characterSet:r,backgroundColor:[255,230,170],getText:function(t,e){var n=e.index;return"  ".concat(a.get(o-1-n),"  ")},getSize:function(t,e){var n=e.index;return c[o-1-n]},sizeMaxPixels:30,sizeUnits:"meters",wrapLongitude:!0,fontFamily:'"Roboto Slab"',getPosition:function(t,a){var r=a.index,i=a.target;return i[0]=e[o-1-r],i[1]=n[o-1-r],i}})}},{key:"makePoints",value:function(t){var e=t.lng,n=t.lat,a=t.onHover,o=t.onClick;return new y.a({id:"points".concat(e.length),data:{length:e.length},pickable:!0,onHover:a,onClick:o,radiusMinPixels:2,radiusMaxPixels:20,getRadius:10,wrapLongitude:!0,getPosition:function(t,a){var o=a.index,r=(a.data,a.target);return r[0]=e[e.length-1-o],r[1]=n[e.length-1-o],r},getFillColor:[100,100,50],getLineColor:[0,0,0]})}},{key:"render",value:function(){var t=this;if(null==this.state)return o.a.createElement("h1",null,"loading very soon!");var e=[],n=[],a=this.state,r=a.pages,i=a.lng,s=a.lat,h=a.title,d=a.characterSet,f=a.pagepick,m=a.pageclick,g=a.allsims,p=a.farsims,v=a.onlyFar,b=a.only100kTitles,y=a.pointLayer,S=a.db,E=a.placeToZoom,A=a.finishedZoomOnLoad,T=v?p:g,j=b?"first100kTitles":"allTitles",F=this.state[j],L=f||m;if(null!=r){if(S&&s&&i&&h&&null!==E){var M=O({db:S,title:h,input:E}).find((function(t){return t.label===E}));if(M){var P=this.zoomTo({pageIndex:M.value,anchor:E});P.viewState.onTransitionEnd=function(){return t.setState({finishedZoomOnLoad:!0})},this.setState(Object(u.a)({},P,{placeToZoom:null}))}else this.setState({placeToZoom:null,finishedZoomOnLoad:!0})}if(A&&!F){var z=b?1e5:5e5,I=function(e){var n=e.index,a=e.picked;return t.setState({pagepick:a?z-1-n+1:null})},D=function(e){var n=e.index,a=e.picked;t.setState({pageclick:a?z-1-n+1:null}),window.location.hash=h.get(z-1-n)};setTimeout((function(){return t.setState(Object(c.a)({},j,t.makeTitles({lng:i,lat:s,title:h,characterSet:d,onHover:I,onClick:D,count:z})))}),0)}if(!y&&i){this.setState({pointLayer:this.makePoints({lng:i,lat:s,onHover:function(e){var n=e.index,a=e.picked;return t.setState({pagepick:a?i.length-1-n+1:null})},onClick:function(e){var n=e.index,a=e.picked;t.setState({pageclick:a?i.length-1-n+1:null}),window.location.hash=h.get(i.length-1-n)}})})}if(e.push(y),e.push(F),L&&T&&y&&y.context){var H=[i[L-1],s[L-1]],B=Array.from(T.values(),(function(t){return t[L]})).filter((function(t){return t>0}));B.sort((function(t,e){return(255&e)-(255&t)}));var Z=y.context.viewport,R=B.map((function(t){return s[(t>>8)-1]})),Q=B.map((function(t){return i[(t>>8)-1]})),U=B.map((function(t){return[Math.max(0,255-5*(255&t)),Math.min(2*(255&t),255),Math.min(5*(255&t),255)]})),W=Z.project(H),J=Object(l.a)(W,2),N=J[0],V=J[1],$=B.map((function(t,e){var n=Z.project([Q[e],R[e]]),a=Object(l.a)(n,2),o=a[0],r=a[1];return(180*Math.atan2(V-r,o-N)/Math.PI+360)%360})),q=Array.from({length:50}).join(" "),G=new x.a({id:"line-layer-".concat(L),data:B,getWidth:20,getSourcePosition:H,getTargetPosition:function(t,e){var n=e.index;return[Q[n],R[n]]},getColor:function(t,e){var n=e.index;return U[n]}});e.push(G);var K=new w.a({id:"text-layer-".concat(L),data:{length:B.length+1},characterSet:d,backgroundColor:[234,255,234],fontFamily:'"Roboto Slab"',getSize:30,getPosition:H,getAngle:function(t,e){var n=e.index;return n===B.length?0:$[n]},getTextAnchor:function(t,e){return e.index===B.length?"middle":"start"},getColor:function(t,e){var n=e.index;return n===B.length?[0,0,0]:U[n]},getText:function(t,e){var n=e.index;return n===B.length?"    ".concat(h.get(L-1),"    "):"".concat(q).concat(h.get((B[n]>>8)-1),"  ")}});e.push(K);var X=Array.from({length:B.length},(function(t,e){return e}));X.sort((function(t,e){return $[t]-$[e]})),n=X.map((function(t){var e=(B[t]>>8)-1;return{color:U[t],name:h.get(e),pageIndex:e}}))}}var Y=!(S&&h);return o.a.createElement("div",null,o.a.createElement("div",{id:"colophon"},"\xa9 Lee Butterman 2020. Made in Oakland, California."),o.a.createElement("div",{id:"searchresults"},o.a.createElement("div",null,i?"".concat(i.length," places. "):"Loading places. ",T?"":"Loading similarities. ",F?"":"Adding place labels. "),o.a.createElement("br",null),b?o.a.createElement("div",null,o.a.createElement("input",{id:"is100k",type:"checkbox",checked:b,onChange:function(e){return!window.confirm("Preparing half a million titles to render takes a minute. Are you sure you want to wait?")||t.setState({only100kTitles:!1})}}),o.a.createElement("label",{htmlFor:"is100k"}," top 100k labels only")):null,o.a.createElement("div",null,o.a.createElement("input",{id:"isfar",type:"checkbox",checked:v,onChange:function(e){return t.setState({onlyFar:e.target.checked})},disabled:!T}),o.a.createElement("label",{htmlFor:"isfar"}," distant relations only ",T?"":"(loading)"," ")),o.a.createElement(C.a,{options:Y?[]:O({db:S,title:h,input:this.state.searchboxtext}),value:this.state.searchboxtext,filterOption:function(){return!0},onInputChange:function(e){return t.setState({searchboxtext:e})},onChange:function(e){var n=e.label,a=e.value;return t.setState(Object(u.a)({},t.zoomTo({pageIndex:a,anchor:n}),{searchboxtext:n}))},isDisabled:Y,placeholder:Y?"Loading autocomplete":"Search"}),o.a.createElement("div",{id:"radiallist"},n.length>0?o.a.createElement("div",null,o.a.createElement("br",null),"\u21b6 Similar to ",h.get(L-1),":"):null,n.map((function(e){var n=e.color,a=e.name,r=e.pageIndex;return o.a.createElement("a",{key:"lhs-".concat(L,"-").concat(r),href:"#",onClick:function(e){e&&e.preventDefault(),t.setState(Object(u.a)({},t.zoomTo({pageIndex:r,anchor:a})))},style:{display:"block",color:"white",backgroundColor:"rgb(".concat(n.join(","),")")}},a)})))),o.a.createElement("div",null,o.a.createElement(k.a,{viewState:this.state.viewState,controller:!0,layers:e,id:"maincanvas",onViewStateChange:function(e){var n=e.viewState;return t.setState({viewState:n})}})))}},{key:"zoomTo",value:function(t){var e=t.pageIndex,n=t.anchor;return window.location.hash=n,{pageclick:e+1,viewState:Object(u.a)({},this.state.viewState,{longitude:this.state.lng[e],latitude:this.state.lat[e],zoom:this.state.onlyFar?9:11,transitionDuration:"auto",transitionInterpolator:new b.a,transitionEasing:function(t){return M(M(t))}})}}}]),e}(o.a.Component),O=function(t){var e=t.db,n=t.input,a=t.title;return Array.from(F({db:e,input:n}),(function(t){return{value:t-1,label:a.get(t-1)}}))},F=h.a.mark((function t(e){var n,a,o;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.db,a=e.input,(o=n.prepare("select rowid from titles where titles match ? order by rowid limit 40")).bind([L(a)]);case 3:if(!o.step()){t.next=8;break}return t.next=6,o.getAsObject().rowid;case 6:t.next=3;break;case 8:case"end":return t.stop()}}),t)})),L=function(t){return t.toLocaleLowerCase().split(/[^a-z0-9\u0080-\uFFFF]+/).filter((function(t){return t.length>0})).join(" NEAR ")+"*"},M=function(t){return 3*t*t-2*t*t*t},P=j;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(P,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[224,1,2]]]);
//# sourceMappingURL=main.805285d1.chunk.js.map