(this["webpackJsonpstylegan2-flask-optimizer-client"]=this["webpackJsonpstylegan2-flask-optimizer-client"]||[]).push([[0],{18:function(e,t,a){e.exports=a(35)},23:function(e,t,a){},31:function(e,t,a){},35:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(5),c=a.n(s),i=(a(23),a(3)),u=a(1),o=a.n(u),l=a(8),h=a(13),p=a(14),f=a(16),b=a(15),m=a(17),v=a(10),d=a(2),x=a(6),g=a(4),k=a(9),w=a.n(k),O=(a(31),a(11)),j=a(32),E=a(34),y="https://gpu.leebutterman.com",L=function(e){return"".concat(y,"/alignfaces?u64rawfaces=").concat(e)},S=function(e){return"".concat(y,"/render9000?u64latents=").concat(e)},z=function(e,t){return"".concat(y,"/optimize?lr=1&decayrate=0.95&iterations=100&u64reference=").concat(e,"&u64latents=").concat(t)},A=function(e){return e.split(/,/)[1].replace(/[+]/g,"-").replace(/[/]/g,"_")},F=Array.from({length:49152},(function(){return"A"})).join(""),C=function(e,t,a){return Float32Array.from({length:t.length},(function(n,r){return e*t[r]+a[r]}))},I=function(e){return new Float32Array(Object(O.decode)(e))},D=function(e,t,a,n,r){return s=C(r*(t/10),N(a,n),I(e)),Object(O.encode)(s.buffer);var s},N=function(e,t){var a=e.split(" ").map((function(e){return t.get(e)})),n=Object(v.a)(a,2),r=n[0],s=n[1];return C(-1,I(r),I(s))};function T(e,t){return _.apply(this,arguments)}function _(){return(_=Object(x.a)(o.a.mark((function e(t,a){var n,r,s,c,i,u,l,h,p,f,b;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.a)(fetch(t));case 2:if((n=e.sent).ok){e.next=7;break}a(n),e.next=44;break;case 7:r=B(n.body),s=R(r),c=U(s),i=!0,u=!1,e.prev=12,h=Object(g.a)(c);case 14:return e.next=16,Object(d.a)(h.next());case 16:return p=e.sent,i=p.done,e.next=20,Object(d.a)(p.value);case 20:if(f=e.sent,i){e.next=28;break}return b=f,e.next=25,b;case 25:i=!0,e.next=14;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(12),u=!0,l=e.t0;case 34:if(e.prev=34,e.prev=35,i||null==h.return){e.next=39;break}return e.next=39,Object(d.a)(h.return());case 39:if(e.prev=39,!u){e.next=42;break}throw l;case 42:return e.finish(39);case 43:return e.finish(34);case 44:case"end":return e.stop()}}),e,null,[[12,30,34,44],[35,,39,43]])})))).apply(this,arguments)}function U(e){return M.apply(this,arguments)}function M(){return(M=Object(x.a)(o.a.mark((function e(t){var a,n,r,s,c,i,u,l,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="",n=!0,r=!1,e.prev=3,c=Object(g.a)(t);case 5:return e.next=7,Object(d.a)(c.next());case 7:return i=e.sent,n=i.done,e.next=11,Object(d.a)(i.value);case 11:if(u=e.sent,n){e.next=26;break}a+=u,l=void 0;case 16:if(!((l=a.indexOf("\n"))>=0)){e.next=23;break}return h=a.slice(0,l+1),e.next=20,h;case 20:a=a.slice(l+1),e.next=16;break;case 23:n=!0,e.next=5;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(3),r=!0,s=e.t0;case 32:if(e.prev=32,e.prev=33,n||null==c.return){e.next=37;break}return e.next=37,Object(d.a)(c.return());case 37:if(e.prev=37,!r){e.next=40;break}throw s;case 40:return e.finish(37);case 41:return e.finish(32);case 42:if(!(a.length>0)){e.next=45;break}return e.next=45,a;case 45:case"end":return e.stop()}}),e,null,[[3,28,32,42],[33,,37,41]])})))).apply(this,arguments)}function R(e){return q.apply(this,arguments)}function q(){return(q=Object(x.a)(o.a.mark((function e(t){var a,n,r,s,c,i,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=!0,n=!1,e.prev=2,s=Object(g.a)(t);case 4:return e.next=6,Object(d.a)(s.next());case 6:return c=e.sent,a=c.done,e.next=10,Object(d.a)(c.value);case 10:if(i=e.sent,a){e.next=18;break}return u=i,e.next=15,new TextDecoder("utf-8").decode(u);case 15:a=!0,e.next=4;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(2),n=!0,r=e.t0;case 24:if(e.prev=24,e.prev=25,a||null==s.return){e.next=29;break}return e.next=29,Object(d.a)(s.return());case 29:if(e.prev=29,!n){e.next=32;break}throw r;case 32:return e.finish(29);case 33:return e.finish(24);case 34:case"end":return e.stop()}}),e,null,[[2,20,24,34],[25,,29,33]])})))).apply(this,arguments)}function B(e){return G.apply(this,arguments)}function G(){return(G=Object(x.a)(o.a.mark((function e(t){var a,n,r,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.getReader(),e.prev=1;case 2:return e.next=5,Object(d.a)(a.read());case 5:if(n=e.sent,r=n.done,s=n.value,!r){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,s;case 12:e.next=2;break;case 14:return e.prev=14,a.releaseLock(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,,14,17]])})))).apply(this,arguments)}var J=function(e){function t(e){var a;Object(h.a)(this,t),(a=Object(f.a)(this,Object(b.a)(t).call(this,e))).state={imageDataURL:null,u64AlignedFaces:null,u64Latents:null,facemathslider:3,facemathdropdown:"brian trixie2"};var n=new Map([["brian","./brian-firkus3_01.latents"],["trixie1","./trixie-mattel1_01.latents"],["trixie2","./trixie-mattel-2_01.latents"],["lsb1","./lsb1_01.latents"],["lsb2","./lsb2_01.latents"],["lsb3","./lsb3_01.latents"],["lsb4","./lsb4_01.latents"],["lsb5","./lsb5_01.latents"]]);return a.loadFaces(n),a}return Object(m.a)(t,e),Object(p.a)(t,[{key:"loadFaces",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var a,n,r,s,c,i,u,l,h,p,f,b,m,d,x,k,w,O=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e){return O.setState({error:"loadFaces error ".concat(e.status)})},n=new Map([["src",F],["dst",F]]),r=!0,s=!1,c=void 0,e.prev=5,i=t[Symbol.iterator]();case 7:if(r=(u=i.next()).done){e.next=45;break}l=Object(v.a)(u.value,2),h=l[0],p=l[1],f=!0,b=!1,e.prev=11,d=Object(g.a)(T(p,a));case 13:return e.next=15,d.next();case 15:return x=e.sent,f=x.done,e.next=19,x.value;case 19:if(k=e.sent,f){e.next=26;break}w=k,n.set(h,w);case 23:f=!0,e.next=13;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(11),b=!0,m=e.t0;case 32:if(e.prev=32,e.prev=33,f||null==d.return){e.next=37;break}return e.next=37,d.return();case 37:if(e.prev=37,!b){e.next=40;break}throw m;case 40:return e.finish(37);case 41:return e.finish(32);case 42:r=!0,e.next=7;break;case 45:e.next=51;break;case 47:e.prev=47,e.t1=e.catch(5),s=!0,c=e.t1;case 51:e.prev=51,e.prev=52,r||null==i.return||i.return();case 54:if(e.prev=54,!s){e.next=57;break}throw c;case 57:return e.finish(54);case 58:return e.finish(51);case 59:this.setState({faces:n}),console.log(n);case 61:case"end":return e.stop()}}),e,this,[[5,47,51,59],[11,28,32,42],[33,,37,41],[52,,54,58]])})));return function(t){return e.apply(this,arguments)}}()},{key:"optimize",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t,a,n,r,s,c,u,l,h,p,f,b,m,v=this,d=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.length>0&&void 0!==d[0]?d[0]:"",!0!==this.state["".concat(t,"optimizeLatch")]){e.next=4;break}return this.setState(Object(i.a)({},"".concat(t,"optimizeAgain"),!0)),e.abrupt("return");case 4:if(console.log("optimizing ".concat(t)),this.state["".concat(t,"optimizeLatch")]=!0,this.state["".concat(t,"optimizeAgain")]=!1,this.setState(Object(i.a)({},"".concat(t,"lastOptimize"),Date.now())),a=this.state,n=a["".concat(t,"u64AlignedFaces")],null!==(r=a["".concat(t,"u64Latents")])&&null!==n&&0!==n.length){e.next=11;break}return e.abrupt("return");case 11:s=z(n[0],r),this.setState({error:null}),c=function(e){return v.setState({error:"OPTIMIZE error ".concat(e.status)})},e.prev=14,u=!0,l=!1,e.prev=17,p=Object(g.a)(T(s,c));case 19:return e.next=21,p.next();case 21:return f=e.sent,u=f.done,e.next=25,f.value;case 25:if(b=e.sent,u){e.next=33;break}m=b,this.setState(Object(i.a)({},"".concat(t,"u64Latents"),m)),this.state.faces.set(t,m);case 30:u=!0,e.next=19;break;case 33:e.next=39;break;case 35:e.prev=35,e.t0=e.catch(17),l=!0,h=e.t0;case 39:if(e.prev=39,e.prev=40,u||null==p.return){e.next=44;break}return e.next=44,p.return();case 44:if(e.prev=44,!l){e.next=47;break}throw h;case 47:return e.finish(44);case 48:return e.finish(39);case 49:e.next=54;break;case 51:e.prev=51,e.t1=e.catch(14),this.setState({error:"OPTIMIZE error run ".concat(e.t1)});case 54:this.state["".concat(t,"optimizeLatch")]=!1,this.setState(Object(i.a)({},"".concat(t,"lastOptimize"),Date.now())),!0===this.state["".concat(t,"optimizeAgain")]&&this.optimize(t);case 57:case"end":return e.stop()}}),e,this,[[14,51],[17,35,39,49],[40,,44,48]])})));return function(){return e.apply(this,arguments)}}()},{key:"onDrop",value:function(){var e=Object(l.a)(o.a.mark((function e(t,a){var n,r,s,c,u,l,h,p,f,b,m,d,x,k,w,O,y,S,z,C=this,I=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(v.a)(a,1),r=n[0],s=I.length>2&&void 0!==I[2]?I[2]:"",e.next=4,j(r);case 4:return c=e.sent,u=c.width,l=c.height,e.next=9,u>l?E(r,0,1024,{imageType:"jpeg",quality:.7}):E(r,1024,0,{imageType:"jpeg",quality:.7});case 9:if(h=e.sent,this.setState(Object(i.a)({},"".concat(s,"imageDataURL"),h)),h&&h.length&&0!==h.length){e.next=15;break}this.setState((p={},Object(i.a)(p,"".concat(s,"u64AlignedFaces"),null),Object(i.a)(p,"".concat(s,"u64Latents"),null),p)),e.next=55;break;case 15:b=L(A(h)),m=function(e){return C.setState({error:"ALIGNFACES error ".concat(e.status)})},d=[],this.setState((f={},Object(i.a)(f,"".concat(s,"u64AlignedFaces"),d),Object(i.a)(f,"".concat(s,"u64Latents"),F),f)),this.state.faces.set(s,F),x=!0,k=!1,e.prev=22,O=Object(g.a)(T(b,m));case 24:return e.next=26,O.next();case 26:return y=e.sent,x=y.done,e.next=30,y.value;case 30:if(S=e.sent,x){e.next=38;break}z=S,d.push(z),this.setState(Object(i.a)({},"".concat(s,"alignedFacesCount"),d.length));case 35:x=!0,e.next=24;break;case 38:e.next=44;break;case 40:e.prev=40,e.t0=e.catch(22),k=!0,w=e.t0;case 44:if(e.prev=44,e.prev=45,x||null==O.return){e.next=49;break}return e.next=49,O.return();case 49:if(e.prev=49,!k){e.next=52;break}throw w;case 52:return e.finish(49);case 53:return e.finish(44);case 54:d.length>0&&this.optimize(s);case 55:case"end":return e.stop()}}),e,this,[[22,40,44,54],[45,,49,53]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"useFacelessUpload",value:function(){this.setState({u64AlignedFaces:[A(this.state.imageDataURL)]})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"Face-math selfie makeover"),r.a.createElement("div",{className:"error"},this.state.error),r.a.createElement("div",{className:"picker"},r.a.createElement(w.a,{withIcon:!0,buttonText:"Let me take a selfie",onChange:function(t,a){return e.onDrop(t,a)},singleImage:!0})),r.a.createElement("div",{className:"facemath"},"src dst"!==this.state.facemathdropdown?r.a.createElement("img",{src:S(this.state.faces?this.state.faces.get(String(this.state.facemathdropdown).split(" ")[0],F):F)}):r.a.createElement("div",{className:"iuib"},this.state.srcu64Latents?r.a.createElement("img",{src:S(this.state.srcu64Latents),title:"enhance!",onClick:function(){return e.optimize("src")}}):"encoded faces show up here",r.a.createElement(w.a,{withIcon:!0,buttonText:"starting point",onChange:function(t,a){return e.onDrop(t,a,"src")},singleImage:!0})),r.a.createElement("div",{className:"iuib"},r.a.createElement("input",{type:"range",min:0,max:11,value:this.state.facemathslider,onChange:function(t){return e.setState({facemathslider:1*t.target.value})}})," \xb1 ",10*this.state.facemathslider,"%",r.a.createElement("br",null),r.a.createElement("select",{value:this.state.facemathdropdown,onChange:function(t){return e.setState({facemathdropdown:t.target.value})}},r.a.createElement("option",{value:"brian trixie2"},"\xb1 Trixie Mattel 2"),r.a.createElement("option",{value:"brian trixie1"},"\xb1 Trixie Mattel 1"),r.a.createElement("option",{value:"lsb4 lsb5"},"\xb1 Glasses"),r.a.createElement("option",{value:"src dst"},"\xb1 choose your own!"))),"src dst"!==this.state.facemathdropdown?r.a.createElement("img",{src:S(this.state.faces?this.state.faces.get(String(this.state.facemathdropdown).split(" ")[1],F):F)}):r.a.createElement("div",{className:"iuib"},this.state.dstu64Latents?r.a.createElement("img",{src:S(this.state.dstu64Latents),title:"enhance!",onClick:function(){return e.optimize("dst")}}):"encoded faces show up here",r.a.createElement(w.a,{withIcon:!0,buttonText:"ending point",onChange:function(t,a){return e.onDrop(t,a,"dst")},singleImage:!0})),r.a.createElement("hr",null),null===this.state.u64Latents?"":[-1,-.5,-.25,0,.25,.5,1].map((function(t){return r.a.createElement("img",{src:S(D(e.state.u64Latents,e.state.facemathslider,e.state.facemathdropdown,e.state.faces,t))})}))),r.a.createElement("div",null,"\xa0 ",this.state.optimizeLatch?"\u26a1":""," ",this.state.optimizeAgain?"\ud834\udd0e":""),r.a.createElement("div",{className:"latentface"},null===this.state.u64Latents?"encoded faces show up here":r.a.createElement("img",{src:S(this.state.u64Latents),onClick:function(){return e.optimize()}})),r.a.createElement("div",{className:"alignedfaces"},null===this.state.u64AlignedFaces?null===this.state.imageDataURL?r.a.createElement("i",null,"aligned faces show up here"):r.a.createElement("i",null,"aligning..."):0===this.state.u64AlignedFaces.length?r.a.createElement("button",{onClick:function(){return e.useFacelessUpload()}},"Use this even though it doesn't look like it has a face"):this.state.u64AlignedFaces.map((function(e){return r.a.createElement("img",{src:(t=e,"data:image/webp;base64,".concat(t.replace(/[-]/g,"+").replace(/[_]/g,"/")))});var t}))))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[18,1,2]]]);
//# sourceMappingURL=main.f08d9947.chunk.js.map